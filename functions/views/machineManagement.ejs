<HTML>

    <HEAD>
      <!-- <meta http-equiv="refresh" content="05"/> -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <link href="../../css/style.css" rel="stylesheet" type="text/css" />
      <style>
        .open-button {
          color: white;
          padding: 16px 20px;
          border: none;
          cursor: pointer;
          right: 28px;
          width: 280px;
        }
      
        /* The popup form - hidden by default */
        .form-popup {
          display: none;
          right: 15px;
          border: 3px solid #f1f1f1;
          z-index: 1;
          position: absolute;
          background-color: white;
        }
      
        /* Add styles to the form container */
        .form-container {
          max-width: 300px;
          /* padding: 10px; */
          background-color: white;
          left:0;
        }
      
        /* Full-width input fields */
        .form-container input[type=number]{
          width: 100%;
          padding: 15px;
          margin: 5px 0 22px 0;
          border: none;
          background: #f1f1f1;
        }
      
        /* When the inputs get focus, do something */
        .form-container input[type=number]:focus{
          background-color: #ddd;
          outline: none;
        }
      
        /* Set a style for the submit/login button */
        .form-container .btn {
          background-color: #4CAF50;
          color: white;
          padding: 16px 20px;
          border: none;
          cursor: pointer;
          width: 100%;
          margin-bottom:10px;
          opacity: 0.8;
        }
      
        /* Add a red background color to the cancel button */
        .form-container .cancel {
          background-color: red;
        }
        .hover_bkgr_fricc{
          background:rgba(0,0,0,.4);
          cursor:pointer;
          display:none;
          height:100%;
          position:fixed;
          text-align:center;
          top:0;
          width:100%;
          z-index:10000;
      }
      .hover_bkgr_fricc .helper{
          display:inline-block;
          height:100%;
          vertical-align:middle;
      }
      .hover_bkgr_fricc > div {
          background-color: #fff;
          box-shadow: 10px 10px 60px #555;
          display: inline-block;
          height: auto;
          max-width: 551px;
          min-height: 100px;
          vertical-align: middle;
          width: 60%;
          position: relative;
          border-radius: 8px;
          padding: 15px 5%;
      }
      .popupCloseButton {
          background-color: #fff;
          border: 3px solid #999;
          border-radius: 50px;
          cursor: pointer;
          display: inline-block;
          font-family: arial;
          font-weight: bold;
          position: absolute;
          top: -20px;
          right: -20px;
          font-size: 25px;
          line-height: 30px;
          width: 30px;
          height: 30px;
          text-align: center;
      }
      .popupCloseButton:hover {
          background-color: #ccc;
      }
      .trigger_popup_fricc {
          cursor: pointer;
          margin: 20px;
          display: inline-block;
          font-weight: bold;
          color: white;
      }
      /*Drop Down Css*/
      
      .dropbtn {
        position: relative;
        background-color: #4d75b7;
        border: none;
        color: white;
        padding: 20px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 20px 30px;
        cursor: pointer;
        width: 150px;
        height: 100px;
      }
      
      .dropdown {
        display: inline-block;

      }
      
      .dropdown-content {
        position: absolute;
        top:80%;
        width: 150px;
        display: none;
        background-color: #f9f9f9;
        min-width: 150px;
        left: 30px;
        box-shadow: 0px 80px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
      }
      
      .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }
      
      .dropdown-content a:hover {background-color: #f1f1f1}
      
      .dropdown:hover .dropdown-content {
        display: block;
      }
      
      .dropdown:hover .dropbtn {
        background-color: #3e8e41;
      }
      .temp{
          position: relative;
          left:30%;
          width: 70%;
          height: 150px;
      }
      .temp2{
          position: relative;
        background-color: #4d75b7;
        top:8%;
        border: none;
        color: white;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 20px 30px;
        cursor: pointer;
        width: 150px;
        height: 100px;
      }
        /* Add some hover effects to buttons */
      
      </style>
    </HEAD>
    
    <body>
        <div class="mainFrame">
            <div class="up">
                <div class="IMG">
                </div>
              </div>
              <div class="topnav">
                <a href="/logout">Logout</a>
                     <a href="/contact" style="align-content: center">Contact</a>
                <%if(presents == "remonet.shalaka@gmail.com" || admin ==true){%>
                    <a href="../admin/userManagement">User Management</a>
                <%}%>
                <a href="../modules">Home</a>
            </div>
      <h1 style="padding-left: 42%">Machine Data</h1>
      <div class="temp">
      <div class="dropdown">
      <button  class="dropbtn" >Machine Management</button>
      <div class="dropdown-content">
        <% for(var i in assetData.machine_distinct){%>
          <a href="../DataRetrieval/assetMachineParams?machine=<%= assetData.machine_distinct[i]%>" class="trigger_popup_fricc"><%= assetData.machine_distinct[i] %></a>
        <%}%>
      </div>
      </div>
      <div class="dropdown">
      <button  class="dropbtn" >Gateway Management</button>
      <div class="dropdown-content">
        <% for(var i in assetData.gateway_distinct){%>
          <a href="../dataRetrieval/assetgatewayParams?gateway=<%=assetData.gateway_distinct[i] %>" class="trigger_popup_fricc"><%= assetData.gateway_distinct[i] %></a>
        <%}%>
      </div>
        </div>
      <button class="temp2" type="button" onclick="location.href='assetGraphs'">Data Visualization</button>
    </div>
    
      <table align="center" cellspacing="20" id="data">
        <col width = auto>
        <tr class="columns">
          <th><input type="checkbox" onclick="toggle(this)"/>Select all</th>
    
          <th>Gateway</th>
          <th style="padding-left: 10px;">DateTime</th>
          <th>Location</th>
          <th>Machine</th>
          <th>Location</th>
          <th><a href="#" class="trigger_popup_fricc" onclick="openFormTooltemp()">Tool Temperature</a></th>
          <div class="hover_bkgr_fricc" id="myForm_tooltemp">
            <form action="/dataRetrieval/Machinetooltemp" class="form-container" method="post">
    
              <span class="helper"></span>
                <div>
                  <h2>Set Limits</h2>
                  <label for="upperlimit"><b>Upper Limit</b></label>
                  <input type="number" placeholder="Enter Upper Limit" name="UpperLimitTTooltemp" value="" required><br>

                  <label for="lowerlimit"><b>Lower Limit</b></label>
                      <input type="number" placeholder="Enter Lower Limit" name="LowerLimitTooltemp" value="" required><br>
        
                  <button type="submit" class="btn">Save</button>
                  <button type="button" class="btn cancel" onclick="closeFormTooltemp()">Close</button>
              </div>
            </form>
          </div>
              <th><a href="#" class="trigger_popup_fricc" onclick="openFormVibration()">Vibration</a></th>
              <div class="hover_bkgr_fricc" id="myForm_vibration">
                <form action="/DataRetrieval/Machinevibration" class="form-container" method="post">
    
                  <span class="helper"></span>
                    <div>
                      <h1>Set Limits</h1>
                      <label for="upperlimit"><b>Upper Limit</b></label>
                      <input type="number" placeholder="Enter Upper Limit" name="UpperLimitVibration" value="" required><br>

                      <label for="lowerlimit"><b>Lower Limit</b></label>
                          <input type="number" placeholder="Enter Lower Limit" name="LowerLimitVibration" value="" required><br>
        
                      <button type="submit" class="btn">Save</button>
                      <button type="button" class="btn cancel" onclick="closeFormVibration()">Close</button>
                  </div>
                </form>
              </div>
          <script>
           function openFormTooltemp() {document.getElementById("myForm_tooltemp").style.display = "block";}
          function closeFormTooltemp() {document.getElementById("myForm_tooltemp").style.display = "none";}
          function openFormVibration() {document.getElementById("myForm_vibration").style.display = "block";}
         function closeFormVibration() {document.getElementById("myForm_vibration").style.display = "none";}
          </script>
          <script>
          function toggle(source) {
            checkboxes = document.getElementsByName('c');
            if (source.checked) {
                 for (var i = 0; i < checkboxes.length; i++) {
                     if (checkboxes[i].type == 'checkbox') {
                         checkboxes[i].checked = true;
                     }
                 }
             } else {
                 for (var i = 0; i < checkboxes.length; i++) {
                     console.log(i)
                     if (checkboxes[i].type == 'checkbox') {
                         checkboxes[i].checked = false;
                     }
                 }
             }
          }
          </script>
          <% for(var i in assetData.data){%>
            <%for(var j in assetData.data[i].Records.Gateway){%>   
        <tr>
          <td class="calign"><input type="checkbox" name = "c"/></td>
          <td class="ralign"><%= assetData.data[i].Records.Gateway[j] %></td>
          <td class="calign"><%= assetData.data[i].Records.DateTime[j] %></td>
          <td class="lalign"><%= assetData.data[i].Records.Location[j] %></td>
          <td class="lalign"><%= assetData.data[i].Machine %></td>
    
          <td class="ralign" >(<%= assetData.data[i].Records.LocationX[j]%>,<%= assetData.data[i].Records.LocationY[j]%>)</td>
    
          <% if(assetData.data[i].Records.Temperature[j] < assetData.data[i].tooltemp_lower){ %>
          <td class="ralign" style="padding-left: 80px;"><font color="blue"><%= assetData.data[i].Records.Temperature[j] %></font></td>
        <% }else if(assetData.data[i].Records.Temperature[j] > assetData.data[i].tooltemp_upper){ %>
          <td class="ralign" style="padding-left: 80px;"><font color="red"><%= assetData.data[i].Records.Temperature[j] %></font></td>
        <% } else { %>
          <td class="ralign" style="padding-left: 80px;"><font color="green"><%= assetData.data[i].Records.Temperature[j] %></font></td>
        <% }%>
    
        <% if(assetData.data[i].Records.Vibration[j] < assetData.data[i].vibration_lower){ %>
          <td class="ralign" style="padding-left: 55px;"><font color="blue"><%= assetData.data[i].Records.Vibration[j] %></font></td>
        <% }else if(assetData.data[i].Records.Vibration[j] > assetData.data[i].vibration_upper){ %>
          <td class="ralign" style="padding-left: 55px;"><font color="red"><%= assetData.data[i].Records.Vibration[j] %></font></td>
        <% } else { %>
          <td class="ralign" style="padding-left: 55px;"><font color="green"><%= assetData.data[i].Records.Vibration[j] %></font></td>
        <% }%>
    
        </tr>
    
        <%}%>
        <%}%>
        </tr>
      </table>
    
      <% include footer.ejs %>
        </div>
    </body>
    
    </HTML>
    